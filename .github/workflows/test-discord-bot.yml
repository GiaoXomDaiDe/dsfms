name: Deploy Notifications

on:
  workflow_run:
    workflows: ["Deploy"]
    types:
      - completed

jobs:
  notify-deployment:
    name: Notify Deployment Status
    runs-on: ubuntu-latest
    # Only notify for main branch deployments to avoid duplicates
    if: github.event.workflow_run.head_branch == 'main'
    steps:
      - name: Notify Deployment Success
        if: github.event.workflow_run.conclusion == 'success'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#28a745"
          username: "DSFMS Deployment Bot"
          message: |
            ✅ **DEPLOYMENT SUCCESSFUL**

            **📦 Repository:** ${{ github.repository }}
            **🌿 Branch:** ${{ github.event.workflow_run.head_branch }}
            **📝 Commit:** `${{ github.event.workflow_run.head_sha }}`
            **👤 Author:** ${{ github.actor }}
            **⏱️ Status:** Production deployment completed

            🚀 Application is now live and ready for use.

            🔗 **[View Details](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**

      - name: Notify Deployment Failure
        if: github.event.workflow_run.conclusion == 'failure'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#dc3545"
          username: "DSFMS Deployment Bot"
          message: |
            ❌ **DEPLOYMENT FAILED**

            **📦 Repository:** ${{ github.repository }}
            **🌿 Branch:** ${{ github.event.workflow_run.head_branch }}
            **📝 Commit:** `${{ github.event.workflow_run.head_sha }}`
            **👤 Author:** ${{ github.actor }}
            **⚠️ Status:** Deployment failed

            🔧 Please check the logs and resolve the issues.

            🔗 **[View Error Logs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**

      - name: Notify Deployment Cancelled
        if: github.event.workflow_run.conclusion == 'cancelled'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#ffc107"
          username: "DSFMS Deployment Bot"
          message: |
            ⚠️ **DEPLOYMENT CANCELLED**

            **📦 Repository:** ${{ github.repository }}
            **🌿 Branch:** ${{ github.event.workflow_run.head_branch }}
            **📝 Commit:** `${{ github.event.workflow_run.head_sha }}`
            **👤 Author:** ${{ github.actor }}
            **🛑 Status:** Deployment was cancelled

            🔗 **[View Details](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**
