name: Deploy Notifications

on:
  workflow_run:
    workflows: ["Deploy"]
    types:
      - completed

jobs:
  notify-deployment:
    name: Notify Deployment Status
    runs-on: ubuntu-latest
    # Only notify for main branch deployments to avoid duplicates
    if: github.event.workflow_run.head_branch == 'main'
    steps:
      - name: Notify Deployment Success
        if: github.event.workflow_run.conclusion == 'success'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#28a745"
          username: "DSFMS Deployment Bot"
          message: |
            âœ… **DEPLOYMENT SUCCESSFUL**

            **ğŸ“¦ Repository:** ${{ github.repository }}
            **ğŸŒ¿ Branch:** ${{ github.event.workflow_run.head_branch }}
            **ğŸ“ Commit:** `${{ github.event.workflow_run.head_sha }}`
            **ğŸ‘¤ Author:** ${{ github.actor }}
            **â±ï¸ Status:** Production deployment completed

            ğŸš€ Application is now live and ready for use.

            ğŸ”— **[View Details](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**

      - name: Notify Deployment Failure
        if: github.event.workflow_run.conclusion == 'failure'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#dc3545"
          username: "DSFMS Deployment Bot"
          message: |
            âŒ **DEPLOYMENT FAILED**

            **ğŸ“¦ Repository:** ${{ github.repository }}
            **ğŸŒ¿ Branch:** ${{ github.event.workflow_run.head_branch }}
            **ğŸ“ Commit:** `${{ github.event.workflow_run.head_sha }}`
            **ğŸ‘¤ Author:** ${{ github.actor }}
            **âš ï¸ Status:** Deployment failed

            ğŸ”§ Please check the logs and resolve the issues.

            ğŸ”— **[View Error Logs](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**

      - name: Notify Deployment Cancelled
        if: github.event.workflow_run.conclusion == 'cancelled'
        uses: appleboy/discord-action@v1.2.0
        with:
          webhook_url: ${{ secrets.WEBHOOK_URL }}
          color: "#ffc107"
          username: "DSFMS Deployment Bot"
          message: |
            âš ï¸ **DEPLOYMENT CANCELLED**

            **ğŸ“¦ Repository:** ${{ github.repository }}
            **ğŸŒ¿ Branch:** ${{ github.event.workflow_run.head_branch }}
            **ğŸ“ Commit:** `${{ github.event.workflow_run.head_sha }}`
            **ğŸ‘¤ Author:** ${{ github.actor }}
            **ğŸ›‘ Status:** Deployment was cancelled

            ğŸ”— **[View Details](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }})**
